<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting Started with Red Hat OpenShift &mdash; NVIDIA Network Operator v24.7.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/omni-style.css" type="text/css" />
      <link rel="stylesheet" href="_static/api-styles.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/mermaid-init.js"></script>
        <script src="_static/design-tabs.js"></script>
        <script src="_static/version.js"></script>
        <script src="_static/social-media.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Customization Options" href="customizations/customization.html" />
    <link rel="prev" title="Getting Started with Kubernetes" href="getting-started-kubernetes.html" />
 


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


<a href="index.html">
  <img src="_static/nvidia-logo-white.png" class="logo" alt="Logo"/>
</a>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">NVIDIA Network Operator</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="platform-support.html">Platform Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started-kubernetes.html">Getting Started with Kubernetes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started with Red Hat OpenShift</a></li>
<li class="toctree-l1"><a class="reference internal" href="customizations/customization.html">Customization Options and CRDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="life-cycle-management.html">Life Cycle Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced-configurations.html">Advanced Configurations</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NVIDIA Network Operator</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">


<li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
  
<li>Getting Started with Red Hat OpenShift</li>

      <li class="wy-breadcrumbs-aside">
      </li>
<li class="wy-breadcrumbs-aside">

  <span>&nbsp;</span>
</li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-started-with-red-hat-openshift">
<h1>Getting Started with Red Hat OpenShift<a class="headerlink" href="#getting-started-with-red-hat-openshift" title="Permalink to this headline"></a></h1>
<div class="contents local topic" id="on-this-page">
<p class="topic-title">On this page</p>
<ul class="simple">
<li><p><a class="reference internal" href="#network-operator-deployment-on-an-openshift-container-platform" id="id1">Network Operator Deployment on an OpenShift Container Platform</a></p>
<ul>
<li><p><a class="reference internal" href="#node-feature-discovery" id="id2">Node Feature Discovery</a></p></li>
<li><p><a class="reference internal" href="#sr-iov-network-operator" id="id3">SR-IOV Network Operator</a></p></li>
<li><p><a class="reference internal" href="#gpu-operator" id="id4">GPU Operator</a></p></li>
<li><p><a class="reference internal" href="#network-operator-installation" id="id5">Network Operator Installation</a></p>
<ul>
<li><p><a class="reference internal" href="#network-operator-installation-using-openshift-catalog" id="id6">Network Operator Installation Using OpenShift Catalog</a></p></li>
<li><p><a class="reference internal" href="#network-operator-installation-using-openshift-oc-cli" id="id7">Network Operator Installation using OpenShift OC CLI</a></p>
<ul>
<li><p><a class="reference internal" href="#verification" id="id8">Verification</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-network-operator-to-create-nicclusterpolicy-in-openshift-container-platform" id="id9">Using Network Operator to Create NicClusterPolicy in OpenShift Container Platform</a></p>
<ul>
<li><p><a class="reference internal" href="#deployment-examples-for-openshift-container-platform" id="id10">Deployment Examples For OpenShift Container Platform</a></p>
<ul>
<li><p><a class="reference internal" href="#network-operator-deployment-with-a-host-device-network-ocp" id="id11">Network Operator Deployment with a Host Device Network - OCP</a></p></li>
<li><p><a class="reference internal" href="#network-operator-deployment-with-sr-iov-legacy-mode-ocp" id="id12">Network Operator Deployment with SR-IOV Legacy Mode - OCP</a></p></li>
<li><p><a class="reference internal" href="#network-operator-deployment-with-the-rdma-shared-device-plugin-ocp" id="id13">Network Operator Deployment with the RDMA Shared Device Plugin - OCP</a></p></li>
<li><p><a class="reference internal" href="#network-operator-deployment-for-dpdk-workloads-ocp" id="id14">Network Operator Deployment for DPDK Workloads - OCP</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="network-operator-deployment-on-an-openshift-container-platform">
<h2>Network Operator Deployment on an OpenShift Container Platform<a class="headerlink" href="#network-operator-deployment-on-an-openshift-container-platform" title="Permalink to this headline"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently, NVIDIA Network Operator does not support Single Node OpenShift (SNO) deployments.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is recommended to have dedicated control plane nodes for OpenShift deployments with NVIDIA Network Operator.</p>
</div>
<section id="node-feature-discovery">
<h3>Node Feature Discovery<a class="headerlink" href="#node-feature-discovery" title="Permalink to this headline"></a></h3>
<p>To enable Node Feature Discovery, please follow the official <a class="reference external" href="https://docs.openshift.com/container-platform/latest/hardware_enablement/psap-node-feature-discovery-operator.html">guide</a>.
A single instance of Node Feature Discovery is expected to be used in the cluster.</p>
<p>An example of Node Feature Discovery configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfd.openshift.io/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodeFeatureDiscovery</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfd-instance</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openshift-nfd</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">operand</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openshift-nfd</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/openshift4/ose-node-feature-discovery:v4.10</span><span class="w"></span>
<span class="w">    </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span><span class="w"></span>
<span class="w">  </span><span class="nt">workerConfig</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">configData</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">      </span><span class="no">sources:</span><span class="w"></span>
<span class="w">        </span><span class="no">pci:</span><span class="w"></span>
<span class="w">          </span><span class="no">deviceClassWhitelist:</span><span class="w"></span>
<span class="w">            </span><span class="no">- &quot;02&quot;</span><span class="w"></span>
<span class="w">            </span><span class="no">- &quot;03&quot;</span><span class="w"></span>
<span class="w">            </span><span class="no">- &quot;0200&quot;</span><span class="w"></span>
<span class="w">            </span><span class="no">- &quot;0207&quot;</span><span class="w"></span>
<span class="w">          </span><span class="no">deviceLabelFields:</span><span class="w"></span>
<span class="w">            </span><span class="no">- vendor</span><span class="w"></span>
<span class="w">  </span><span class="nt">customConfig</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">configData</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>Verify that the following label is present on the nodes containing NVIDIA networking hardware: <cite>feature.node.kubernetes.io/pci-15b3.present=true</cite></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc describe node <span class="p">|</span> grep -E <span class="s1">&#39;Roles|pci&#39;</span> <span class="p">|</span> grep -v <span class="s2">&quot;control-plane&quot;</span>

Roles:              worker
                    cpu-feature.node.kubevirt.io/invpcid<span class="o">=</span><span class="nb">true</span>
                    cpu-feature.node.kubevirt.io/pcid<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-102b.present<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-10de.present<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-10de.sriov.capable<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-14e4.present<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-15b3.present<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-15b3.sriov.capable<span class="o">=</span><span class="nb">true</span>
Roles:              worker
                    cpu-feature.node.kubevirt.io/invpcid<span class="o">=</span><span class="nb">true</span>
                    cpu-feature.node.kubevirt.io/pcid<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-102b.present<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-10de.present<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-10de.sriov.capable<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-14e4.present<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-15b3.present<span class="o">=</span><span class="nb">true</span>
                    feature.node.kubernetes.io/pci-15b3.sriov.capable<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
</section>
<section id="sr-iov-network-operator">
<h3>SR-IOV Network Operator<a class="headerlink" href="#sr-iov-network-operator" title="Permalink to this headline"></a></h3>
<p>If you are planning to use SR-IOV, follow these <a class="reference external" href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/installing-sriov-operator.html">instructions</a> to install SR-IOV Network Operator on an OpenShift Container Platform.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The SR-IOV resources created will have the <cite>openshift.io</cite> prefix.</p>
</div>
<p>For the default SriovOperatorConfig CR to work with the NVIDIA DOCA Driver container, please run this command to update the following values:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc patch sriovoperatorconfig default <span class="se">\</span>
  --type<span class="o">=</span>merge -n openshift-sriov-network-operator <span class="se">\</span>
  --patch <span class="s1">&#39;{ &quot;spec&quot;: { &quot;configDaemonNodeSelector&quot;: { &quot;network.nvidia.com/operator.mofed.wait&quot;: &quot;false&quot;, &quot;node-role.kubernetes.io/worker&quot;: &quot;&quot;, &quot;feature.node.kubernetes.io/pci-15b3.sriov.capable&quot;: &quot;true&quot; } } }&#39;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SR-IOV Network Operator configuration documentation can be found on the <a class="reference external" href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-operator.html#configuring-sriov-operator">Official Website</a>.</p>
</div>
</section>
<section id="gpu-operator">
<h3>GPU Operator<a class="headerlink" href="#gpu-operator" title="Permalink to this headline"></a></h3>
<p>If you plan to use GPUDirect, follow <a class="reference external" href="https://docs.nvidia.com/datacenter/cloud-native/gpu-operator/openshift/contents.html">this</a> to install GPU Operator on an OpenShift Container Platform.</p>
<p>Make sure to enable RDMA and disable useHostMofed in the driver section in the spec of the ClusterPolicy CR.</p>
</section>
<section id="network-operator-installation">
<h3>Network Operator Installation<a class="headerlink" href="#network-operator-installation" title="Permalink to this headline"></a></h3>
<section id="network-operator-installation-using-openshift-catalog">
<h4>Network Operator Installation Using OpenShift Catalog<a class="headerlink" href="#network-operator-installation-using-openshift-catalog" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p>In the OpenShift Container Platform web console side menu, select Operators &gt; OperatorHub, and search for the NVIDIA Network Operator.</p></li>
<li><p>Select NVIDIA Network Operator, and click Install in the first screen and in the subsequent one.</p></li>
<li><p>For additional information, see the <a class="reference external" href="https://docs.openshift.com/container-platform/latest/operators/admin/olm-adding-operators-to-cluster.html">Red Hat OpenShift Container Platform Documentation</a>.</p></li>
</ul>
</section>
<section id="network-operator-installation-using-openshift-oc-cli">
<h4>Network Operator Installation using OpenShift OC CLI<a class="headerlink" href="#network-operator-installation-using-openshift-oc-cli" title="Permalink to this headline"></a></h4>
<ol class="arabic">
<li><p>Create a namespace for the Network Operator.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc create namespace nvidia-network-operator
</pre></div>
</div>
</li>
<li><p>Install the Network Operator in the namespace created in the previous step by creating the below objects. Run the following command to get the channel value required for the next step:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc get packagemanifest nvidia-network-operator -n openshift-marketplace -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.defaultChannel}&#39;</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>stable
</pre></div>
</div>
</li>
<li><p>Create the following Subscription CR, and save the YAML in the network-operator-sub.yaml file:</p>
<pre class="literal-block">apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: nvidia-network-operator
  namespace: nvidia-network-operator
spec:
  channel: &quot;v24.7&quot;
  name: nvidia-network-operator
  source: certified-operators
  sourceNamespace: openshift-marketplace</pre>
</li>
<li><p>Create the subscription object by running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc create -f network-operator-sub.yaml
</pre></div>
</div>
</li>
<li><p>Change to the network-operator project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc project nvidia-network-operator
</pre></div>
</div>
</li>
</ol>
<section id="verification">
<h5>Verification<a class="headerlink" href="#verification" title="Permalink to this headline"></a></h5>
<p>To verify that the operator deployment is successful, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc get pods -n nvidia-network-operator
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>NAME                                                          READY   STATUS    RESTARTS   AGE
nvidia-network-operator-controller-manager-8f8ccf45c-zgfsq    <span class="m">2</span>/2     Running   <span class="m">0</span>          1m
</pre></div>
</div>
<p>A successful deployment shows a <cite>Running</cite> status.</p>
</section>
</section>
</section>
<section id="using-network-operator-to-create-nicclusterpolicy-in-openshift-container-platform">
<h3>Using Network Operator to Create NicClusterPolicy in OpenShift Container Platform<a class="headerlink" href="#using-network-operator-to-create-nicclusterpolicy-in-openshift-container-platform" title="Permalink to this headline"></a></h3>
<p>See Deployment Examples for OCP:</p>
<section id="deployment-examples-for-openshift-container-platform">
<h4>Deployment Examples For OpenShift Container Platform<a class="headerlink" href="#deployment-examples-for-openshift-container-platform" title="Permalink to this headline"></a></h4>
<p>In OCP, some components are deployed by default like Multus and WhereAbouts, whereas others, such as NFD and SR-IOV Network Operator must be deployed manually, as described in the Installation section.</p>
<p>In addition, since there is no use of the Helm chart, the configuration should be done via the NicClusterPolicy CRD.</p>
<p>Following are examples of NicClusterPolicy configuration for OCP.</p>
<section id="network-operator-deployment-with-a-host-device-network-ocp">
<h5>Network Operator Deployment with a Host Device Network - OCP<a class="headerlink" href="#network-operator-deployment-with-a-host-device-network-ocp" title="Permalink to this headline"></a></h5>
<p>Network Operator deployment with:</p>
<p>SR-IOV device plugin, single SR-IOV resource pool:</p>
<ul class="simple">
<li><p>There is no need for a secondary network configuration, as it is installed by default in OCP.</p></li>
</ul>
<pre class="literal-block">apiVersion: mellanox.com/v1alpha1
kind: NicClusterPolicy
metadata:
  name: nic-cluster-policy
spec:
  ofedDriver:
    image: doca-driver
    repository: nvcr.io/nvidia/mellanox
    version: 24.07-0.6.0.0-1
     startupProbe:
      initialDelaySeconds: 10
      periodSeconds: 20
    livenessProbe:
      initialDelaySeconds: 30
      periodSeconds: 30
    readinessProbe:
      initialDelaySeconds: 10
      periodSeconds: 30
  sriovDevicePlugin:
      image: sriov-network-device-plugin
      repository: ghcr.io/k8snetworkplumbingwg
      version: v3.7.0
      config: |
        {
          &quot;resourceList&quot;: [
              {
                  &quot;resourcePrefix&quot;: &quot;nvidia.com&quot;,
                  &quot;resourceName&quot;: &quot;hostdev&quot;,
                  &quot;selectors&quot;: {
                      &quot;vendors&quot;: [&quot;15b3&quot;],
                      &quot;isRdma&quot;: true
                  }
              }
          ]
        }</pre>
<p>Following the deployment, the Network Operator should be configured, and K8s networking deployed to use it in pod configuration.
The <cite>host-device-net.yaml`</cite> configuration file for such a deployment:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mellanox.com/v1alpha1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HostDeviceNetwork</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostdev-net</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">networkNamespace</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">resourceName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nvidia.com/hostdev&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">ipam</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">    </span><span class="no">{</span><span class="w"></span>
<span class="w">      </span><span class="no">&quot;type&quot;: &quot;whereabouts&quot;,</span><span class="w"></span>
<span class="w">      </span><span class="no">&quot;datastore&quot;: &quot;kubernetes&quot;,</span><span class="w"></span>
<span class="w">      </span><span class="no">&quot;kubernetes&quot;: {</span><span class="w"></span>
<span class="w">        </span><span class="no">&quot;kubeconfig&quot;: &quot;/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig&quot;</span><span class="w"></span>
<span class="w">      </span><span class="no">},</span><span class="w"></span>
<span class="w">      </span><span class="no">&quot;range&quot;: &quot;192.168.3.225/28&quot;,</span><span class="w"></span>
<span class="w">      </span><span class="no">&quot;exclude&quot;: [</span><span class="w"></span>
<span class="w">       </span><span class="no">&quot;192.168.3.229/30&quot;,</span><span class="w"></span>
<span class="w">       </span><span class="no">&quot;192.168.3.236/32&quot;</span><span class="w"></span>
<span class="w">      </span><span class="no">],</span><span class="w"></span>
<span class="w">      </span><span class="no">&quot;log_file&quot; : &quot;/var/log/whereabouts.log&quot;,</span><span class="w"></span>
<span class="w">      </span><span class="no">&quot;log_level&quot; : &quot;info&quot;</span><span class="w"></span>
<span class="w">    </span><span class="no">}</span><span class="w"></span>
</pre></div>
</div>
<p>The <cite>pod.yaml</cite> configuration file for such a deployment:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostdev-test-pod</span><span class="w"></span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">k8s.v1.cni.cncf.io/networks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostdev-net</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span><span class="w"></span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;rdma image&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">doca-test-ctr</span><span class="w"></span>
<span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">capabilities</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">add</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;IPC_LOCK&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">requests</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">nvidia.com/hostdev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">      </span><span class="nt">limits</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">nvidia.com/hostdev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-c</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sleep inf</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="network-operator-deployment-with-sr-iov-legacy-mode-ocp">
<h5>Network Operator Deployment with SR-IOV Legacy Mode - OCP<a class="headerlink" href="#network-operator-deployment-with-sr-iov-legacy-mode-ocp" title="Permalink to this headline"></a></h5>
<p>This deployment mode supports SR-IOV in legacy mode.
Note that the SR-IOV Network Operator is required as described in the Deployment for OCP section.</p>
<pre class="literal-block">apiVersion: mellanox.com/v1alpha1
kind: NicClusterPolicy
metadata:
  name: nic-cluster-policy
spec:
  ofedDriver:
    image: doca-driver
    repository: nvcr.io/nvidia/mellanox
    version: 24.07-0.6.0.0-1
     startupProbe:
      initialDelaySeconds: 10
      periodSeconds: 20
    livenessProbe:
      initialDelaySeconds: 30
      periodSeconds: 30
    readinessProbe:
      initialDelaySeconds: 10
      periodSeconds: 30</pre>
<p>Sriovnetwork node policy and K8s networking should be deployed.
<cite>sriovnetwork-node-policy.yaml</cite> configuration file for such a deployment:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sriovnetwork.openshift.io/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SriovNetworkNodePolicy</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-1</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">openshift-sriov-network-operator</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">deviceType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">netdevice</span><span class="w"></span>
<span class="w">  </span><span class="nt">mtu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1500</span><span class="w"></span>
<span class="w">  </span><span class="nt">nicSelector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">vendor</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;15b3&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">pfNames</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ens2f0&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">feature.node.kubernetes.io/pci-15b3.present</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">numVfs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span><span class="w"></span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span><span class="w"></span>
<span class="w">  </span><span class="nt">isRdma</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">resourceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sriovlegacy</span><span class="w"></span>
</pre></div>
</div>
<p>The <cite>sriovnetwork.yaml</cite> configuration file for such a deployment:</p>
<pre class="literal-block">apiVersion: sriovnetwork.openshift.io/v1
kind: SriovNetwork
metadata:
  name: &quot;sriov-network&quot;
  namespace:  openshift-sriov-network-operator
spec:
  vlan: 0
  networkNamespace: &quot;default&quot;
  resourceName: &quot;sriovlegacy&quot;
  ipam: |-
    {
      &quot;datastore&quot;: &quot;kubernetes&quot;,
      &quot;kubernetes&quot;: {
        &quot;kubeconfig&quot;: &quot;/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig&quot;
      },
      &quot;log_file&quot;: &quot;/tmp/whereabouts.log&quot;,
      &quot;log_level&quot;: &quot;debug&quot;,
      &quot;type&quot;: &quot;whereabouts&quot;,
      &quot;range&quot;: &quot;192.168.101.0/24&quot;
  }</pre>
<p>Note that the resource prefix in this case will be <cite>openshift.io</cite>.
The <cite>pod.yaml</cite> configuration file for such a deployment:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testpod1</span><span class="w"></span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">k8s.v1.cni.cncf.io/networks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sriov-network</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appcntr1</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;image&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span><span class="w"></span>
<span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">capabilities</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">add</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;IPC_LOCK&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-c</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sleep inf</span><span class="w"></span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">requests</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">openshift.io/sriovlegacy</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">limits</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">openshift.io/sriovlegacy</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1&#39;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="network-operator-deployment-with-the-rdma-shared-device-plugin-ocp">
<h5>Network Operator Deployment with the RDMA Shared Device Plugin - OCP<a class="headerlink" href="#network-operator-deployment-with-the-rdma-shared-device-plugin-ocp" title="Permalink to this headline"></a></h5>
<p>The following is an example of RDMA Shared with MacVlanNetwork:</p>
<pre class="literal-block">apiVersion: mellanox.com/v1alpha1
kind: NicClusterPolicy
metadata:
  name: nic-cluster-policy
spec:
  ofedDriver:
    image: doca-driver
    repository: nvcr.io/nvidia/mellanox
    version: 24.07-0.6.0.0-1
     startupProbe:
      initialDelaySeconds: 10
      periodSeconds: 20
    livenessProbe:
      initialDelaySeconds: 30
      periodSeconds: 30
    readinessProbe:
      initialDelaySeconds: 10
      periodSeconds: 30
  rdmaSharedDevicePlugin:
    config: |
      {
        &quot;configList&quot;: [
          {
            &quot;resourceName&quot;: &quot;rdmashared&quot;,
            &quot;rdmaHcaMax&quot;: 1000,
            &quot;selectors&quot;: {
              &quot;ifNames&quot;: [&quot;enp4s0f0np0&quot;]
            }
          }
        ]
      }
    image: k8s-rdma-shared-dev-plugin
    repository: nvcr.io/nvidia/cloud-native
    version: v1.5.1</pre>
<p>The <cite>macvlan-net-ocp.yaml</cite> configuration file for such a deployment in an OpenShift Platform:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mellanox.com/v1alpha1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MacvlanNetwork</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rdmashared-net</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">networkNamespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"></span>
<span class="w">  </span><span class="nt">master</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enp4s0f0np0</span><span class="w"></span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span><span class="w"></span>
<span class="w">  </span><span class="nt">mtu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1500</span><span class="w"></span>
<span class="w">  </span><span class="nt">ipam</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;whereabouts&quot;,</span><span class="nv"> </span><span class="s">&quot;range&quot;:</span><span class="nv"> </span><span class="s">&quot;16.0.2.0/24&quot;,</span><span class="nv"> </span><span class="s">&quot;gateway&quot;:</span><span class="nv"> </span><span class="s">&quot;16.0.2.1&quot;}&#39;</span><span class="w"></span>
</pre></div>
</div>
<p>The <cite>pod.yaml</cite> configuration file for such a deployment:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-rdma-shared-1</span><span class="w"></span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">k8s.v1.cni.cncf.io/networks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rdmashared-net</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myimage</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rdma-shared-1</span><span class="w"></span>
<span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">capabilities</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">add</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IPC_LOCK</span><span class="w"></span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">limits</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">rdma/rdmashared</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">      </span><span class="nt">requests</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">rdma/rdmashared</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="network-operator-deployment-for-dpdk-workloads-ocp">
<h5>Network Operator Deployment for DPDK Workloads - OCP<a class="headerlink" href="#network-operator-deployment-for-dpdk-workloads-ocp" title="Permalink to this headline"></a></h5>
<p>In order to configure <cite>HUGEPAGES</cite> in OpenShift, refer to this <a class="reference external" href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/what-huge-pages-do-and-how-they-are-consumed-by-apps.html">steps</a>.</p>
<p>For SR-IOV Network Operator configuration instructions, visit the Official <a class="reference external" href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-operator.html#configuring-sriov-operator">Website</a>.</p>
</section>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, NVIDIA.
      <span class="lastupdated">Last updated on Aug 22, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>