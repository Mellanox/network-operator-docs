<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NVIDIA Network Operator Deployment on Disconnected OpenShift &mdash; NVIDIA Network Operator v25.10.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
      <link rel="stylesheet" href="../_static/omni-style.css" type="text/css" />
      <link rel="stylesheet" href="../_static/api-styles.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/mermaid-init.js"></script>
        <script src="../_static/design-tabs.js"></script>
        <script src="../_static/version.js"></script>
        <script src="../_static/social-media.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NIC Configuration Operator" href="../nic-conf-operator/nic-configuration-operator.html" />
    <link rel="prev" title="NVIDIA Network Operator Deployment Guide with OpenShift" href="deployment-guide-openshift.html" />
 


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


<a href="../index.html">
  <img src="../_static/nvidia-logo-white.png" class="logo" alt="Logo"/>
</a>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">NVIDIA Network Operator</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform-support.html">Platform Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started-with-kubernetes.html">Getting Started with Kubernetes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../getting-started-with-openshift.html">Getting Started with Red Hat OpenShift</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="deployment-guide-openshift.html">Deployment Guide with OpenShift</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Deployment in Disconnected OpenShift</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#network-layout-and-server-roles">Network Layout and Server Roles</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mirroring-images-from-public-registries">Mirroring images from public registries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-openshift-cli">Install OpenShift CLI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-oc-mirror-plugin">Install oc-mirror plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-the-oc-mirror-credentials">Configure the oc-mirror credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-the-oc-mirror-isc-imagesourceconfiguration">Create the oc-mirror ISC (ImageSourceConfiguration)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-the-operators-images-tar-file">Create the operators’ images TAR file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#upload-the-container-images-to-the-private-registry">Upload the container images to the private registry</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#move-the-tar-file-to-the-disconnected-environment">Move the TAR file to the disconnected environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mirroring-the-operator-from-disk-to-private-registry">Mirroring the operator from disk to private registry</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configure-the-openshift-catalog">Configure the Openshift catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-operators-in-the-disconnected-environment">Installing Operators in the disconnected environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-the-instances">Create the instances</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-the-nfd-instance">Create the NFD instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nvidia-doca-ofed-driver-container-in-disconnected-environment">NVIDIA DOCA OFED driver container in disconnected environment</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#create-local-package-repositories">Create Local Package Repositories</a></li>
<li class="toctree-l5"><a class="reference internal" href="#create-a-precompiled-container-for-the-doca-ofed-driver">Create a precompiled container for the DOCA OFED driver</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#create-the-nic-cluster-policy-instance">Create the NIC Cluster Policy instance</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../nic-conf-operator/nic-configuration-operator.html">NIC Configuration Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customizations/customization.html">Customization Options and CRDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../life-cycle-management.html">Life Cycle Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/advanced.html">Advanced Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../licenses.html">Legal Notices and 3rd Party Licenses</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NVIDIA Network Operator</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">


<li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
  
    <li><a href="../getting-started-with-openshift.html">Getting Started with OpenShift</a> &raquo;</li>
<li>NVIDIA Network Operator Deployment on Disconnected OpenShift</li>

      <li class="wy-breadcrumbs-aside">
      </li>
<li class="wy-breadcrumbs-aside">

  <span>&nbsp;</span>
</li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nvidia-network-operator-deployment-on-disconnected-openshift">
<h1>NVIDIA Network Operator Deployment on Disconnected OpenShift<a class="headerlink" href="#nvidia-network-operator-deployment-on-disconnected-openshift" title="Permalink to this headline"></a></h1>
<div class="contents local topic" id="on-this-page">
<p class="topic-title">On this page</p>
<ul class="simple">
<li><p><a class="reference internal" href="#prerequisites" id="id1">Prerequisites</a></p>
<ul>
<li><p><a class="reference internal" href="#network-layout-and-server-roles" id="id2">Network Layout and Server Roles</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#mirroring-images-from-public-registries" id="id3">Mirroring images from public registries</a></p>
<ul>
<li><p><a class="reference internal" href="#install-openshift-cli" id="id4">Install OpenShift CLI</a></p></li>
<li><p><a class="reference internal" href="#install-oc-mirror-plugin" id="id5">Install oc-mirror plugin</a></p></li>
<li><p><a class="reference internal" href="#configure-the-oc-mirror-credentials" id="id6">Configure the oc-mirror credentials</a></p></li>
<li><p><a class="reference internal" href="#create-the-oc-mirror-isc-imagesourceconfiguration" id="id7">Create the oc-mirror ISC (ImageSourceConfiguration)</a></p></li>
<li><p><a class="reference internal" href="#create-the-operators-images-tar-file" id="id8">Create the operators’ images TAR file</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#upload-the-container-images-to-the-private-registry" id="id9">Upload the container images to the private registry</a></p>
<ul>
<li><p><a class="reference internal" href="#move-the-tar-file-to-the-disconnected-environment" id="id10">Move the TAR file to the disconnected environment</a></p></li>
<li><p><a class="reference internal" href="#mirroring-the-operator-from-disk-to-private-registry" id="id11">Mirroring the operator from disk to private registry</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configure-the-openshift-catalog" id="id12">Configure the Openshift catalog</a></p></li>
<li><p><a class="reference internal" href="#installing-operators-in-the-disconnected-environment" id="id13">Installing Operators in the disconnected environment</a></p></li>
<li><p><a class="reference internal" href="#create-the-instances" id="id14">Create the instances</a></p>
<ul>
<li><p><a class="reference internal" href="#create-the-nfd-instance" id="id15">Create the NFD instance</a></p></li>
<li><p><a class="reference internal" href="#nvidia-doca-ofed-driver-container-in-disconnected-environment" id="id16">NVIDIA DOCA OFED driver container in disconnected environment</a></p>
<ul>
<li><p><a class="reference internal" href="#create-local-package-repositories" id="id17">Create Local Package Repositories</a></p></li>
<li><p><a class="reference internal" href="#create-a-precompiled-container-for-the-doca-ofed-driver" id="id18">Create a precompiled container for the DOCA OFED driver</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#create-the-nic-cluster-policy-instance" id="id19">Create the NIC Cluster Policy instance</a></p></li>
</ul>
</li>
</ul>
</div>
<p>Deploying OpenShift operators in an environment with internet access is typically straightforward. However, in industries like cyber security, military sector or Telco/communications, where security concerns often prohibit internet access, the process becomes more complex. In a disconnected or air-gapped environment, internet access is usually restricted or unavailable.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline"></a></h2>
<p>The following requirements must be met:</p>
<ul class="simple">
<li><p>OpenShift is installed in a disconnected environment</p></li>
<li><p>A private registry is deployed in the disconnected environment</p></li>
</ul>
<section id="network-layout-and-server-roles">
<h3>Network Layout and Server Roles<a class="headerlink" href="#network-layout-and-server-roles" title="Permalink to this headline"></a></h3>
<p>The following network layout is used in this guide:</p>
<a class="reference internal image-reference" href="../_images/disconnected-ocp.png"><img alt="Network layout" src="../_images/disconnected-ocp.png" style="width: 50%;" /></a>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Server Name</p></th>
<th class="head"><p>Services running on</p></th>
<th class="head"><p>Access to Internet</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>srv01</p></td>
<td><p>NTP, DHCP, DNS, HTTP</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>mirror</p></td>
<td><p>Mirroring tools, Local Registry</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>master01, master02, master03</p></td>
<td><p>Control Plane servers in a cluster</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>worker01, worker02</p></td>
<td><p>Workers in a cluster</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="mirroring-images-from-public-registries">
<h2>Mirroring images from public registries<a class="headerlink" href="#mirroring-images-from-public-registries" title="Permalink to this headline"></a></h2>
<p>This section requires an internet connection, for fetching images from public registries.
In our scenario we are using the <cite>mirror</cite> server for this operation.</p>
<section id="install-openshift-cli">
<h3>Install OpenShift CLI<a class="headerlink" href="#install-openshift-cli" title="Permalink to this headline"></a></h3>
<p>Follow the instructions in the <a class="reference external" href="https://docs.redhat.com/en/documentation/openshift_container_platform/latest/html/cli_tools/openshift-cli-oc">OpenShift documentation</a> to install the OpenShift CLI (<cite>oc</cite>).</p>
</section>
<section id="install-oc-mirror-plugin">
<h3>Install oc-mirror plugin<a class="headerlink" href="#install-oc-mirror-plugin" title="Permalink to this headline"></a></h3>
<p>To download the <cite>oc-mirror</cite> CLI plugin, navigate to the <a class="reference external" href="https://console.redhat.com/openshift/downloads">downloads page</a> of the OpenShift Cluster Manager. Under the “OpenShift disconnected installation tools” section, click “Download” for “OpenShift Client (oc) mirror plugin” and save the file.</p>
<p>Extract the archive:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar -xvf oc-mirror.tar.gz
chmod +x oc-mirror
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not rename the oc-mirror file</p>
</div>
<p>To install the <cite>oc-mirror</cite> CLI plugin, place the file in your PATH. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mv oc-mirror /usr/local/bin/
</pre></div>
</div>
<p>Verify that the plugin for <cite>oc-mirror</cite> is installed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc mirror <span class="nb">help</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is no dash (-) between oc and mirror.</p>
</div>
<p>If the command returns help options, then the <cite>oc-mirror</cite> CLI plugin is installed.</p>
</section>
<section id="configure-the-oc-mirror-credentials">
<h3>Configure the oc-mirror credentials<a class="headerlink" href="#configure-the-oc-mirror-credentials" title="Permalink to this headline"></a></h3>
<p>Download your <cite>registry.redhat.io</cite> pull secret from <a class="reference external" href="https://console.redhat.com/openshift/install/pull-secret">Red Hat OpenShift Cluster Manager</a>.</p>
<p>Convert the pull secret to JSON format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat ./pull-secret <span class="p">|</span> jq . &gt; config.json
</pre></div>
</div>
<p>Copy the JSON file to the <cite>.docker</cite> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir ~/.docker
cp config.json ~/.docker/config.json
</pre></div>
</div>
<p>Log in to <cite>registry.redhat.io</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>podman login registry.redhat.io
</pre></div>
</div>
</section>
<section id="create-the-oc-mirror-isc-imagesourceconfiguration">
<h3>Create the oc-mirror ISC (ImageSourceConfiguration)<a class="headerlink" href="#create-the-oc-mirror-isc-imagesourceconfiguration" title="Permalink to this headline"></a></h3>
<p>The oc-mirror tool uses an ISC configuration file to define what needs to be mirrored. This configuration allows you to specify the catalog source name and the versions of the operators you want to mirror.</p>
<p>Find operator channel and release information for the required OpenShift version (example: 4.19):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc mirror list operators --catalogs --version<span class="o">=</span><span class="m">4</span>.19

Available OpenShift OperatorHub catalogs:
OpenShift <span class="m">4</span>.19:
registry.redhat.io/redhat/redhat-operator-index:v4.19
registry.redhat.io/redhat/certified-operator-index:v4.19
registry.redhat.io/redhat/community-operator-index:v4.19
registry.redhat.io/redhat/redhat-marketplace-index:v4.19
</pre></div>
</div>
<p>In order to mirror NFD and NVIDIA Network-Operator, we will use the following catalogs:</p>
<ul class="simple">
<li><p><cite>redhat-operator-index</cite></p></li>
<li><p><cite>certified-operator-index</cite></p></li>
</ul>
<p>Find the channel for NFD operator:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc mirror list operators --catalog<span class="o">=</span>registry.redhat.io/redhat/redhat-operator-index:v4.19 --package<span class="o">=</span>nfd

NAME  DISPLAY NAME  DEFAULT CHANNEL
nfd                 stable

PACKAGE  CHANNEL  HEAD
nfd      stable   nfd.4.19.0-202508120121
</pre></div>
</div>
<p>Find the channel for NVIDIA Network Operator:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc mirror list operators --catalog<span class="o">=</span>registry.redhat.io/redhat/certified-operator-index:v4.19 --package<span class="o">=</span>nvidia-network-operator

NAME                     DISPLAY NAME  DEFAULT CHANNEL
nvidia-network-operator                v25.7

PACKAGE                  CHANNEL  HEAD
nvidia-network-operator  stable   nvidia-network-operator.v25.7.0
nvidia-network-operator  v25.7    nvidia-network-operator.v25.7.0
</pre></div>
</div>
<p>Use the <cite>oc mirror</cite> command to create a template for the ISC configuration file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc mirror init &gt; imagesset-config.yaml
</pre></div>
</div>
<p>Edit the new ISC file and update it using the right catalog and the operators release information you gathered in the previous steps. Here’s an example of an ISC configuration file for our scenario:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ImageSetConfiguration</span><span class="w"></span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mirror.openshift.io/v1alpha2</span><span class="w"></span>
<span class="nt">storageConfig</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">local</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/disk-mirror-dir/metadata</span><span class="w"></span>
<span class="nt">mirror</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">platform</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">channels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stable-4.19</span><span class="w"></span>
<span class="w">      </span><span class="nt">minVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.19.0</span><span class="w"></span>
<span class="w">      </span><span class="nt">maxVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.19.0</span><span class="w"></span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ocp</span><span class="w"></span>
<span class="w">  </span><span class="nt">operators</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">catalog</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/redhat/redhat-operator-index:v4.19</span><span class="w"></span>
<span class="w">    </span><span class="nt">packages</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfd</span><span class="w"></span>
<span class="w">      </span><span class="nt">channels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stable</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">catalog</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/redhat/certified-operator-index:v4.19</span><span class="w"></span>
<span class="w">    </span><span class="nt">packages</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nvidia-network-operator</span><span class="w"></span>
<span class="w">      </span><span class="nt">channels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stable</span><span class="w"></span>
<span class="w">  </span><span class="nt">additionalImages</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/ubi8/ubi:latest</span><span class="w"></span>
<span class="w">  </span><span class="nt">helm</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please keep in mind that you can decide what will be the max and min version of any channel in any catalog according to your requirements. In our case, to save space on storage, we minimized it to one version only.</p>
</div>
</section>
<section id="create-the-operators-images-tar-file">
<h3>Create the operators’ images TAR file<a class="headerlink" href="#create-the-operators-images-tar-file" title="Permalink to this headline"></a></h3>
<p>Create a directory for the image’s TAR file, and then run the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir data
oc mirror --verbose <span class="m">3</span> --config<span class="o">=</span>imagesset-config.yaml file://data
</pre></div>
</div>
<p>Once the operation is completed, the TAR file will appear in created directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls -ltrh data/

total 35G
drwxr-xr-x. <span class="m">3</span> root root  <span class="m">17</span> Jan <span class="m">27</span> <span class="m">07</span>:36 oc-mirror-workspace
-rw-r--r--. <span class="m">1</span> root root 35G Jan <span class="m">27</span> <span class="m">07</span>:40 mirror_seq1_000000.tar
</pre></div>
</div>
</section>
</section>
<section id="upload-the-container-images-to-the-private-registry">
<h2>Upload the container images to the private registry<a class="headerlink" href="#upload-the-container-images-to-the-private-registry" title="Permalink to this headline"></a></h2>
<section id="move-the-tar-file-to-the-disconnected-environment">
<h3>Move the TAR file to the disconnected environment<a class="headerlink" href="#move-the-tar-file-to-the-disconnected-environment" title="Permalink to this headline"></a></h3>
<p>The operational procedures and security requirements can vary significantly from one organization to another. For example, in certain highly restricted environments, you must copy the TAR file to a portable disk, which you take to your disconnected environment’s security team for review.</p>
</section>
<section id="mirroring-the-operator-from-disk-to-private-registry">
<h3>Mirroring the operator from disk to private registry<a class="headerlink" href="#mirroring-the-operator-from-disk-to-private-registry" title="Permalink to this headline"></a></h3>
<p>Once the data has been moved to the disconnected environment, you can begin pushing the images in your private registry. Because you’ve used the <cite>oc-mirror</cite> plugin to push all necessary container images, you must configure the tools accordingly, with the credential information pointing to your private registry instead of the Red Hat public registry.</p>
<p>This is an example of <cite>config.json</cite> file for local registry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /mirror-data/config.json
<span class="o">{</span>
  <span class="s2">&quot;auths&quot;</span>: <span class="o">{</span>
    <span class="s2">&quot;mirror.air-gapped.local:5000&quot;</span>: <span class="o">{</span>
    <span class="s2">&quot;auth&quot;</span>: <span class="s2">&quot;aW5pdDpxYXdzMTI=&quot;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Create a directory to copy the TAR file, and to serve as the destination for <cite>oc mirror</cite> output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir data
</pre></div>
</div>
<p>Copy the TAR file to the destination directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir data
cp mirror_seq1_000000.tar data/
<span class="nb">cd</span> data
</pre></div>
</div>
<p>Execute the <cite>oc mirror</cite> command to upload the container’s images to your private registry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc mirror --verbose <span class="m">3</span> <span class="se">\</span>
--from<span class="o">=</span>./mirror_seq1_000000.tar <span class="se">\</span>
docker://mirror.air-gapped.local:5000/ocp/openshift4
</pre></div>
</div>
<p>Once complete, you get the following directories with similar files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls -ltr data/oc-mirror-workspace/results-1737982710/
total <span class="m">64</span>
drwxr-xr-x. <span class="m">2</span> root root       <span class="m">6</span> Jan <span class="m">27</span> <span class="m">07</span>:58 charts
drwxr-xr-x. <span class="m">2</span> root root       <span class="m">52</span> Jan <span class="m">27</span> <span class="m">08</span>:03 release-signatures
-rw-r--r--. <span class="m">1</span> root root <span class="m">49619</span> Jan <span class="m">27</span> <span class="m">08</span>:03 mapping.txt
-rwxr-xr-x. <span class="m">1</span> root root   <span class="m">253</span> Jan <span class="m">27</span> <span class="m">08</span>:03 catalogSource-cs-redhat-operator-index.yaml
-rwxr-xr-x. <span class="m">1</span> root root   <span class="m">259</span> Jan <span class="m">27</span> <span class="m">08</span>:03 catalogSource-cs-certified-operator-index.yaml
-rwxr-xr-x. <span class="m">1</span> root root  <span class="m">1565</span> Jan <span class="m">27</span> <span class="m">08</span>:03 imageContentSourcePolicy.yaml
</pre></div>
</div>
</section>
</section>
<section id="configure-the-openshift-catalog">
<h2>Configure the Openshift catalog<a class="headerlink" href="#configure-the-openshift-catalog" title="Permalink to this headline"></a></h2>
<p>You must be logged in to your OpenShift instance as a user with cluster-admin privileges.
In our setup we are using kubeconfig file created with OCP deployment in isolated network:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">KUBECONFIG</span><span class="o">=</span>/mirror-data/iso_build/brm_static/auth/kubeconfig
</pre></div>
</div>
<p>Keeping the Openshift default catalogs in a disconnected environment would just trigger unnecessary errors, so disable the default OperatorHub catalog sources:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ oc patch OperatorHub cluster --type json -p <span class="s1">&#39;[{&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/spec/disableAllDefaultSources&quot;, &quot;value&quot;: true}]&#39;</span>
</pre></div>
</div>
<p>Apply the ICSP yaml file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc apply -f /mirror-data/data/oc-mirror-workspace/results-1737982710/imageContentSourcePolicy.yaml
</pre></div>
</div>
<p>Next, create the Red Hat catalog, you could run it for each catalog workspace that you have. In our scenario it’s: <cite>certified-operator-index</cite> and <cite>redhat-operator-index</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc apply -f  data/oc-mirror-workspace/results-1737982710/catalogSource-cs-redhat-operator-index.yaml
oc apply -f data/oc-mirror-workspace/results-1737982710/catalogSource-cs-certified-operator-index.yaml
</pre></div>
</div>
<p>Verify that you can see the catalog in the mirrored operators in UI “Operators &gt; OperatorHub”:</p>
<a class="reference internal image-reference" href="../_images/operator-hub.png"><img alt="../_images/operator-hub.png" src="../_images/operator-hub.png" style="width: 80%;" /></a>
</section>
<section id="installing-operators-in-the-disconnected-environment">
<h2>Installing Operators in the disconnected environment<a class="headerlink" href="#installing-operators-in-the-disconnected-environment" title="Permalink to this headline"></a></h2>
<p>The easiest way to install the operators in OpenShift it’s using the OpenShift UI. Once you have the OpenShift cluster UI open, follow these steps:</p>
<ol class="arabic simple">
<li><p>Click on Operators &gt; OperatorHub</p></li>
<li><p>Select the operator to install</p></li>
<li><p>Keep the default settings and click Install</p></li>
</ol>
</section>
<section id="create-the-instances">
<h2>Create the instances<a class="headerlink" href="#create-the-instances" title="Permalink to this headline"></a></h2>
<p>After successful installation of all operators you must create the instances or polices depending on your use case.</p>
<section id="create-the-nfd-instance">
<h3>Create the NFD instance<a class="headerlink" href="#create-the-nfd-instance" title="Permalink to this headline"></a></h3>
<p>In the web console, click “Operators &gt; Installed Operators”, and then “Node Feature Discovery Operator”
In Details &gt; Provided API’s look for (NFD) NodeFeatureDiscovery “Create instance”</p>
<p>Once the instance creation will completed you can find it in “Operators &gt; Installed Operators &gt; Node Feature Discovery Operator &gt; All instances”</p>
</section>
<section id="nvidia-doca-ofed-driver-container-in-disconnected-environment">
<h3>NVIDIA DOCA OFED driver container in disconnected environment<a class="headerlink" href="#nvidia-doca-ofed-driver-container-in-disconnected-environment" title="Permalink to this headline"></a></h3>
<p>In case you want to use the NVIDIA DOCA OFED driver container in the disconnected environment, the following steps are required:</p>
<section id="create-local-package-repositories">
<h4>Create Local Package Repositories<a class="headerlink" href="#create-local-package-repositories" title="Permalink to this headline"></a></h4>
<p>Create the Local Package Repository required:</p>
<ul class="simple">
<li><p>redhat.repo</p></li>
<li><p>ubi.repo</p></li>
<li><p>cuda.repo</p></li>
</ul>
<p>The detailed instructions and examples about how to create local repositories is available in this <a class="reference external" href="https://access.redhat.com/solutions/7019225">article</a> .
Instructions on how to create a repo file can be found <a class="reference external" href="https://access.redhat.com/solutions/2785791">here</a>.</p>
<p>redhat.repo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>baseos<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>rhel-9-for-x86_64-baseos-rpms
<span class="nv">baseurl</span><span class="o">=</span>http://srv01.air-gapped.local/redhat/9.4/el-9-for-x86_64-baseos-rpms
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span>
<span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>

<span class="o">[</span>apstream<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>rhel-9-for-x86_64-appstream-rpms
<span class="nv">baseurl</span><span class="o">=</span>http://srv01.air-gapped.local/redhat/rhel-9-for-x86_64-appstream-rpms
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span>
<span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>ubi.repo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ubi-9-baseos<span class="o">]</span>
<span class="nv">name</span> <span class="o">=</span> Red Hat Universal Base Image <span class="m">9</span> <span class="o">(</span>RPMs<span class="o">)</span> - BaseOS
<span class="nv">baseurl</span> <span class="o">=</span> http://srv01.air-gapped.local/redhat/ubi-9-baseos-rpms
<span class="nv">enabled</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">gpgcheck</span> <span class="o">=</span> <span class="m">0</span>
<span class="o">[</span>ubi-9-appstream<span class="o">]</span>
<span class="nv">name</span> <span class="o">=</span> Red Hat Universal Base Image <span class="m">9</span> <span class="o">(</span>RPMs<span class="o">)</span> - AppStream
<span class="nv">baseurl</span> <span class="o">=</span> http://srv01.air-gapped.local/redhat/ubi-9-appstream-rpms
<span class="nv">enabled</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">gpgcheck</span> <span class="o">=</span> <span class="m">0</span>
</pre></div>
</div>
<p>cuda.repo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>cuda<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>cuda
<span class="nv">baseurl</span><span class="o">=</span>http://srv01.air-gapped.local/nvidia/cuda
<span class="nv">priority</span><span class="o">=</span><span class="m">0</span>
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span>
<span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>Create the ConfigMap for the repos files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc create configmap repo-config -n nvidia-network-operator  --from-file<span class="o">=</span>redhat.repo --from-file<span class="o">=</span>ubi.repo --from-file<span class="o">=</span>cuda.repo
</pre></div>
</div>
<p>If self-signed certificates are used for an HTTPS based local repository, a ConfigMap must be created for those certificates:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc create configmap cert-config -n nvidia-network-operator --from-file<span class="o">=</span>&lt;path-to-pem-file&gt;
</pre></div>
</div>
</section>
<section id="create-a-precompiled-container-for-the-doca-ofed-driver">
<h4>Create a precompiled container for the DOCA OFED driver<a class="headerlink" href="#create-a-precompiled-container-for-the-doca-ofed-driver" title="Permalink to this headline"></a></h4>
<p>We will use the mirror server to build the precompiled container for the DOCA OFED driver.</p>
<p>Please verify that you have the following:</p>
<ul class="simple">
<li><p>Podman (RH) installed on your build system</p></li>
<li><p>Web access to NVIDIA NIC drivers sources</p></li>
</ul>
<p>Follow the instructions in <a class="reference internal" href="../advanced/doca-drivers.html#advanced-configurations-precompiled"><span class="std std-ref">Precompiled Container Build Instructions for NVIDIA DOCA-OFED Driver Container</span></a> section to build the precompiled container.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need to make the created image accessible in your environment (on the local registry server).
Working with container images is described in this <a class="reference external" href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/building_running_and_managing_containers/assembly_working-with-container-images_building-running-and-managing-containers#assembly_working-with-container-images_building-running-and-managing-containers">page</a>.</p>
</div>
<p>In order to get the sha256 of the image, you can use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>skopeo inspect docker://mirror.air-gapped.local:5000/mellanox/doca-driver:your-tag <span class="p">|</span> jq -r <span class="s1">&#39;.Digest&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="create-the-nic-cluster-policy-instance">
<h3>Create the NIC Cluster Policy instance<a class="headerlink" href="#create-the-nic-cluster-policy-instance" title="Permalink to this headline"></a></h3>
<p>In the web console, click “Operators &gt; Installed Operators”, and then “NVIDIA Network Operator &gt; NicClusterPolicy &gt; Create NicClusterPolicy”</p>
<p>You need to provide required parameters depending on your setup. After editing and overriding our nic-cluster-policy yaml looks like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mellanox.com/v1alpha1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NicClusterPolicy</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nic-cluster-policy</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">ofedDriver</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">certConfig</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-config</span><span class="w"></span>
<span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RESTORE_DRIVER_ON_POD_TERMINATION</span><span class="w"></span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UNLOAD_STORAGE_MODULES</span><span class="w"></span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CREATE_IFNAMES_UDEV</span><span class="w"></span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">forcePrecompiled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">doca-driver</span><span class="w"></span>
<span class="w">      </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mirror-registry-ps</span><span class="w"></span>
<span class="w">      </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
<span class="w">      </span><span class="nt">readinessProbe</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"></span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
<span class="w">      </span><span class="nt">repoConfig</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repo-config</span><span class="w"></span>
<span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mirror.air-gapped.local:5000/mellanox</span><span class="w"></span>
<span class="w">      </span><span class="nt">startupProbe</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"></span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w"></span>
<span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w"></span>
<span class="w">      </span><span class="nt">upgradePolicy</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">autoUpgrade</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">drain</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">deleteEmptyDir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">force</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">podSelector</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w"></span>
<span class="w">      </span><span class="nt">maxParallelUpgrades</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">      </span><span class="nt">safeLoad</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<span class="w">      </span><span class="nt">waitForCompletion</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"></span>
<span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sha256:9a831bfdf85f313b1f5749b7c9b2673bb8fff18b4ff768c9242dabaa4468e449</span><span class="w"></span>
</pre></div>
</div>
<p>Note: Please be sure to provide configured ConfigMaps: <cite>repo-config</cite> and <cite>cert-config</cite>.</p>
<p>If your local repository requires username and password for access you need to create imagePullSecrets and provide this parameter in nic-cluster-policy.yaml:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mirror-registry-ps</span><span class="w"></span>
</pre></div>
</div>
<p>How to create imagePullSecrets:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc -n nvidia-network-operator create secret docker-registry <span class="se">\</span>
--docker-server<span class="o">=</span>mirror.air-gapped.local:5000 <span class="se">\</span>
--docker-username<span class="o">=</span>init <span class="se">\</span>
--docker-password<span class="o">=</span>qaws12 <span class="se">\</span>
mirror-registry-ps
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, NVIDIA.
      <span class="lastupdated">Last updated on Oct 29, 2025.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>